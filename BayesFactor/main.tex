\documentclass[11pt]{article}
 
\newcommand\CG[1]{\textcolor{red}{#1}}

\usepackage{lineno,hyperref}

\usepackage[margin=1 in]{geometry}
\renewcommand{\baselinestretch}{1.25}


%\usepackage{refcheck}
\usepackage{authblk}
\usepackage{galois} % composition function \comp
\usepackage{bm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{amsthm}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage{color}
\usepackage{booktabs}
\usepackage[page,title]{appendix}
%\renewcommand\appendixname{haha}
\usepackage{enumerate}
\usepackage{changepage}
\usepackage{datetime}
\newdate{date}{9}{1}{2017}

%%%%%%%%%%%%%%  Notations %%%%%%%%%%
\DeclareMathOperator{\mytr}{tr}
\DeclareMathOperator{\mydiag}{diag}
\DeclareMathOperator{\myrank}{Rank}
\DeclareMathOperator{\myP}{P}
\DeclareMathOperator{\myE}{E}
\DeclareMathOperator{\myVar}{Var}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}


\newcommand{\Ba}{\mathbf{a}}    \newcommand{\Bb}{\mathbf{b}}    \newcommand{\Bc}{\mathbf{c}}    \newcommand{\Bd}{\mathbf{d}}    \newcommand{\Be}{\mathbf{e}}    \newcommand{\Bf}{\mathbf{f}}    \newcommand{\Bg}{\mathbf{g}}    \newcommand{\Bh}{\mathbf{h}}    \newcommand{\Bi}{\mathbf{i}}    \newcommand{\Bj}{\mathbf{j}}    \newcommand{\Bk}{\mathbf{k}}    \newcommand{\Bl}{\mathbf{l}}
\newcommand{\Bm}{\mathbf{m}}    \newcommand{\Bn}{\mathbf{n}}    \newcommand{\Bo}{\mathbf{o}}    \newcommand{\Bp}{\mathbf{p}}    \newcommand{\Bq}{\mathbf{q}}    \newcommand{\Br}{\mathbf{r}}    \newcommand{\Bs}{\mathbf{s}}    \newcommand{\Bt}{\mathbf{t}}    \newcommand{\Bu}{\mathbf{u}}    \newcommand{\Bv}{\mathbf{v}}    \newcommand{\Bw}{\mathbf{w}}    \newcommand{\Bx}{\mathbf{x}}
\newcommand{\By}{\mathbf{y}}    \newcommand{\Bz}{\mathbf{z}}    
\newcommand{\BA}{\mathbf{A}}    \newcommand{\BB}{\mathbf{B}}    \newcommand{\BC}{\mathbf{C}}    \newcommand{\BD}{\mathbf{D}}    \newcommand{\BE}{\mathbf{E}}    \newcommand{\BF}{\mathbf{F}}    \newcommand{\BG}{\mathbf{G}}    \newcommand{\BH}{\mathbf{H}}    \newcommand{\BI}{\mathbf{I}}    \newcommand{\BJ}{\mathbf{J}}    \newcommand{\BK}{\mathbf{K}}    \newcommand{\BL}{\mathbf{L}}
\newcommand{\BM}{\mathbf{M}}    \newcommand{\BN}{\mathbf{N}}    \newcommand{\BO}{\mathbf{O}}    \newcommand{\BP}{\mathbf{P}}    \newcommand{\BQ}{\mathbf{Q}}    \newcommand{\BR}{\mathbf{R}}    \newcommand{\BS}{\mathbf{S}}    \newcommand{\BT}{\mathbf{T}}    \newcommand{\BU}{\mathbf{U}}    \newcommand{\BV}{\mathbf{V}}    \newcommand{\BW}{\mathbf{W}}    \newcommand{\BX}{\mathbf{X}}
\newcommand{\BY}{\mathbf{Y}}    \newcommand{\BZ}{\mathbf{Z}}    

\newcommand{\bfsym}[1]{\ensuremath{\boldsymbol{#1}}}

 \def\balpha{\bfsym \alpha}
 \def\bbeta{\bfsym \beta}
 \def\bgamma{\bfsym \gamma}             \def\bGamma{\bfsym \Gamma}
 \def\bdelta{\bfsym {\delta}}           \def\bDelta {\bfsym {\Delta}}
 \def\bfeta{\bfsym {\eta}}              \def\bfEta {\bfsym {\Eta}}
 \def\bmu{\bfsym {\mu}}                 \def\bMu {\bfsym {\Mu}}
 \def\bnu{\bfsym {\nu}}
 \def\btheta{\bfsym {\theta}}           \def\bTheta {\bfsym {\Theta}}
 \def\beps{\bfsym \varepsilon}          \def\bepsilon{\bfsym \varepsilon}
 \def\bsigma{\bfsym \sigma}             \def\bSigma{\bfsym \Sigma}
 \def\blambda {\bfsym {\lambda}}        \def\bLambda {\bfsym {\Lambda}}
 \def\bomega {\bfsym {\omega}}          \def\bOmega {\bfsym {\Omega}}
 \def\brho   {\bfsym {\rho}}
 \def\btau{\bfsym {\tau}}
 \def\bxi{\bfsym {\xi}}
 \def\bzeta{\bfsym {\zeta}}
% May add more in future.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\theoremstyle{plain}
\newtheorem{theorem}{\quad\quad Theorem}
\newtheorem{proposition}{\quad\quad Proposition}
\newtheorem{corollary}{\quad\quad Corollary}
\newtheorem{lemma}{\quad\quad Lemma}
\newtheorem{example}{Example}
\newtheorem{assumption}{\quad\quad Assumption}
\newtheorem{condition}{\quad\quad Condition}

\theoremstyle{definition}
\newtheorem{definition}{\quad\quad Definition}
\newtheorem{remark}{\quad\quad Remark}
\theoremstyle{remark}



\title{Bayes factors for linear regression}



\author[1]{Rui Wang}
%\author[2]{xx}
%\author[1,3]{Xingzhong Xu\thanks{Corresponding author\\Email address: xuxz@bit.edu.cn}}
%\affil[1]{
%School of Mathematics and Statistics, Beijing Institute of Technology, Beijing 
    %100081,China
%}
%\affil[2]{
    %xx
%}
%\affil[3]{
%Beijing Key Laboratory on MCAACI, Beijing Institute of Technology, Beijing 100081,China
%}



\begin{document}
\maketitle
\section{Introduction}
This note gives a review for Bayes factors for linear regression.
\section{Mixture of $g$ prior}
This section is adapted from \cite{Liang2008Mixtures}.
Suppose $\BY\in \mathbb R^n$ is generated from the model
\begin{equation*}
    \mathcal M_{\gamma}: \BY=\mathbf 1_n \alpha + \BX \bbeta+\bepsilon,
\end{equation*}
where $\BX \in \mathbb R^{n\times p}$ and $\bepsilon\sim \mathcal N (0, \phi^{-1} \BI_n)$.

Let $\BX_{\gamma}\in \mathbb R^{n\times p_{\gamma}}$ be a submatrix of $\BX$.
Then the submodel $\mathcal M_\gamma$ is defined as 
\begin{equation*}
    \mathcal M_{\gamma}: \BY=\mathbf 1_n \alpha + \BX_\gamma \bbeta_{\gamma}+\bepsilon.
\end{equation*}
The null model $\mathcal M_N $ is 
\begin{equation*}
    \mathcal M_{\gamma}: \BY=\mathbf 1_n \alpha +\bepsilon.
\end{equation*}
We would like to compare $\mathcal M_\gamma$ with $\mathcal M_N$.
Without loss of generality, we assume $\mathbf 1_n^\top \BX_\gamma=0$.
Under $\mathcal M_N$, the $g$ prior is
\begin{equation*}
    p(\alpha,\phi|\mathcal M_N) = \frac{1}{\phi}.
\end{equation*}
Under $\mathcal M_\gamma$, the $g$ prior is
\begin{equation*}
    \bbeta_{\gamma}|\phi,\mathcal M_\gamma \sim \mathcal N (0,\frac{g}{\phi} (\BX_{\gamma}^\top \BX_{\gamma})^{-1}),
    \quad p(\alpha|\phi,\mathcal M_\gamma)\propto 1,
    \quad p(\phi|\mathcal M_\gamma) = \frac{1}{\phi}.
\end{equation*}
The joint pdf is
\begin{equation*}
    \begin{split}
    &p(\BY,\alpha,\bbeta_{\gamma},\phi|\mathcal M_\gamma)
    =
    p(\BY|\alpha,\bbeta_\gamma,\phi,\mathcal M_\gamma)
    p(\bbeta_\gamma |\phi,\mathcal M_\gamma)
    p(\alpha |\phi,\mathcal M_\gamma)
    p(\phi |\mathcal M_\gamma)
    \\
    =&
    (2\pi)^{-(n+p_\gamma)/{2}} g^{-{p_\gamma}/{2}} \phi^{{(n+p_\gamma)}/{2}-1} |\BX_\gamma^\top \BX_\gamma|^{1/2}
    \exp\left\{-\frac{n\phi}{2}(\bar{\BY}-\alpha)^2\right\}
    \\
    &\exp\left\{
        -\frac{\phi (g+1)}{2g}\left\| \BX_\gamma \left(\bbeta_\gamma-\frac{g}{g+1}\hat{\bbeta}_\gamma\right)\right\|^2
        -\frac{\phi}{2(g+1)} \left\|\BX_\gamma \hat{\bbeta}_\gamma\right\|^2
        -\frac{\phi}{2}\left\|\BY-\mathbf 1_n \bar \BY- \BX_\gamma \hat{\bbeta}_\gamma\right\|^2
    \right\},
    \end{split}
\end{equation*}
where $\bar \BY= n^{-1}\mathbf 1_n^\top \BY$,
$\hat{\bbeta}_\gamma =(\BX_\gamma^\top \BX_\gamma)^{-1} \BX_\gamma^\top \BY $.

Direct calculation yields
\begin{equation*}
    p(\BY| \mathcal M_\gamma,g)
    =
    \frac{\Gamma((n-1)/2)}{\pi^{(n-1)/2}\sqrt{n}}
    \left\|\BY-\mathbf 1_n \bar \BY\right\|^{-(n-1)}
    \frac{(1+g)^{(n-p_{\gamma}-1)/2}}{[1+g(1-R_\gamma^2)]^{(n-1)/2}},
\end{equation*}
where $R_\gamma^2 = 1-\|\BY -\mathbf 1_n \bar \BY- \BX_\gamma \hat{\bbeta}_\gamma\|^2/\|\BY-\mathbf 1_n \bar \BY\|^2$.
Also, we have
\begin{equation*}
    p(\BY| \mathcal M_N)
    =
    \frac{\Gamma((n-1)/2)}{\pi^{(n-1)/2}\sqrt{n}}
    \left\|\BY-\mathbf 1_n \bar \BY\right\|^{-(n-1)}.
\end{equation*}
Thus,
\begin{equation*}
    \text{BF}[\mathcal M_\gamma :\mathcal M_N]=
    (1+g)^{(n-p_\gamma-1)/2}
    [1+g(1-R^2_\gamma)]^{-(n-1)/2}.
\end{equation*}

\subsection{Choices of $g$}
\paragraph{Local empirical Bayes.} The local EB estimates a separate $g$ for each model $\mathcal M_\gamma$.
\begin{equation*}
    \hat g_\gamma^{\text{EBL}} =
    \argmax_{g\geq 0} p(\BY | \mathcal M_\gamma, g) 
    =
    \argmax_{g\geq 0} \frac{(1+g)^{(n-p_{\gamma}-1)/2}}{[1+g(1-R_\gamma^2)]^{(n-1)/2}}
    =\max\{F_\gamma-1, 0\},
\end{equation*}
where 
\begin{equation*}
F_\gamma=
\frac{R^2_\gamma/p_\gamma}{
    (1-R^2_\gamma) / (n-1-p_\gamma)
}
\end{equation*}
is the usual $F$ statistic for testing $\bbeta_\gamma=0$.

\paragraph{Global empirical Bayes.} The global EB procedure assumes one common $g$ for all models.
\begin{equation*}
    \hat g_\gamma^{\text{EBG}} =
    \argmax_{g\geq 0} \sum_{\gamma} p(\mathcal M_\gamma) p(\BY | \mathcal M_\gamma, g) 
    =
    \argmax_{g\geq 0} \sum_{\gamma} p(\mathcal M_\gamma) \frac{(1+g)^{(n-p_{\gamma}-1)/2}}{[1+g(1-R_\gamma^2)]^{(n-1)/2}}.
\end{equation*}
In general, this marginal likelihood is not tractable and does not provide a closed-form solution for $\hat g_\gamma^{\text{EBG}}$.
It can be computed by an EM algorithm, which is based on treating both the model indicator and the precision $\phi$ as latent data.







\subsection{Mixtures of $g$ priors}
Under $\mathcal M_\gamma$, the mixtures of $g$ prior take the form
\begin{equation*}
    \bbeta_{\gamma}|g, \phi,\mathcal M_\gamma \sim \mathcal N (0,\frac{g}{\phi} (\BX_{\gamma}^\top \BX_{\gamma})^{-1}),
    \quad \pi(g),
    \quad p(\alpha|\phi,\mathcal M_\gamma)\propto 1,
    \quad p(\phi|\mathcal M_\gamma) = \frac{1}{\phi}.
\end{equation*}

\emph{Zellner-Siow Priors}
\begin{equation*}
    \pi(\bbeta_\gamma | \phi)
    \propto
    \frac{\Gamma(p_{\gamma})}{\pi^{p_\gamma/2}}
    \left|
    \frac{\BX_\gamma^\top \BX_\gamma}{n/\phi}
    \right|^{1/2}
    \left(
        1+\bbeta_\gamma^\top \frac{\BX_\gamma^\top \BX_\gamma}{n/\phi}   \bbeta_\gamma
    \right)^{-p_\gamma/2}
\end{equation*}
The Zellner-Siow priors can be represented as a mixture of $g$ priors with an Inv-Gamma(1/2,n/2) prior on $g$, namely,
\begin{equation*}
    \phi(\bbeta_\gamma|\phi)
    \propto
    \int \mathcal N (0,\frac{g}{\phi} (\BX_{\gamma}^\top \BX_{\gamma})^{-1}) \pi(g) dg,
\end{equation*}
with
\begin{equation*}
    \pi(g)=\frac{(n/2)^{1/2}}{\Gamma(1/2)} g^{-3/2} e^{-n/(2g)}.
\end{equation*}

\emph{Hyper-$g$ priors}
\begin{equation*}
    \pi(g)=\frac{a-2}{2} (1+g)^{-a/2}\mathbf{1}_{(0,\infty)}(g),\quad a>2.
\end{equation*}
Equivalently,
\begin{equation*}
    \frac{g}{1+g} \sim \text{Beta} (1,\frac{a}{2}-1).
\end{equation*}
The null-based Bayes factor is
\begin{equation*}
    \begin{split}
    \text{BF}[\mathcal M_\gamma : \mathcal M_N]=
&
\frac{a-2}{2}\int_{0}^\infty (1+g)^{(n-1-p_\gamma -a)/2} [1+(1-R^2_\gamma)g]^{-(n-1)/2} dg
\\
=&
\frac{a-2}{p_\gamma + a-2}
\times
{}_2 F_1
\left(
    \frac{n-1}{2}, 1;
    \frac{p_\gamma+a}{2};
    R^2_\gamma
\right),
\end{split}
\end{equation*}
where ${}_2 F_1 (a,b;c;z)$ is the Gaussian hypergeometric function defined as
\begin{equation*}
    {}_2 F_1 (a,b;c;z)
    =\frac{\Gamma(c)}{\Gamma(b) \Gamma(c-b)}
    \int_0^1
    \frac{t^{b-1}(1-t)^{c-b-1}}{(1-tz)^a}
    dt.
\end{equation*}

\emph{Beta prime prior}
\cite{maruyama2011} proposed to use the beta prime prior for $g$:
\begin{equation*}
    \pi(g)=\frac{g^b (1+g)^{-a-b-2}}{B(a+1,b+1)}\mathbf{1}_{(0,\infty)}(g),
\end{equation*}
where $a>-1$, $b>-1$.
Equivalently,
\begin{equation*}
    \frac{1}{1+g}\sim \text{Be} (a+1,b+1).
\end{equation*}
They observed that the Bayes factor has a closed form if we take
\begin{equation*}
    b=\frac{n-p_\gamma-5}{2}-a.
\end{equation*}





\section{Intrinsic prior}


\section{Normal-inverse-gamma (NIG) prior}
\cite{zhou2018On}

Consider the testing problem in linear regression with independent normal errors:
\begin{equation*}
    \begin{split}
    H_0:
    \BY|\Ba,\tau \sim \mathcal N (\BW \Ba,\tau^{-1}\BI_n),
    \\
    H_1:
    \BY|\Ba,\Bb, \tau \sim \mathcal N (\BW \Ba + \BL \Bb, \tau^{-1} \BI_n),
    \end{split}
\end{equation*}
where $\BW$ is a full-rank $n\times q$ matrix representing the nuisance covariates, including a column of $\mathbf 1_n$.
$\BL$ is an $n\times p$ matrix representing the covariates of interest.

NIG prior:
\begin{equation*}
    \begin{split}
        \Ba | \tau \sim \mathcal N (0, \tau^{-1} \BV_a),
        \\
        \Bb | \tau \sim \mathcal N (0, \tau^{-1} \BV_b),
        \\
        \tau \sim \text{Gamma} (\kappa_1/2,2/\kappa_2)
        .
    \end{split}
\end{equation*}
Here
\begin{equation*}
        \pi(\tau) =\frac{(\kappa_2/2)^{\kappa_1/2}}{\Gamma (\kappa_1/2)}
        \tau^{\kappa_1/2-1} \exp\left\{-\frac{\kappa_2 \tau}{2}\right\}
\end{equation*}


Then
\begin{equation*}
    \begin{split}
    &f(\BY|\Ba,\Bb, \tau)
    \pi(\Ba|\tau)
    \pi(\Bb|\tau)
    \pi(\tau)
    \\
    =&
    \frac{(\kappa_2/2)^{\kappa_1/2}\tau^{(n+p+q+\kappa_1)/2-1}}
    {
        (2\pi)^{(n+p+q)/2} |\BV_a|^{1/2} |\BV_b|^{1/2} \Gamma(\kappa_1/2)
    }
    \exp\left\{
        -\frac{\tau}{2}
        \left( \|\BY-\BW \Ba -\BL \Bb \|^2+\Ba^\top \BV_a^{-1} \Ba + \Bb^\top \BV_b^{-1} \Bb +\kappa_2\right)
    \right\}
    .
    \end{split}
\end{equation*}
Let $\BH_{\BW}= \BW (\BW^\top \BW)^{-1} \BW^\top$.
Then
\begin{equation*}
    \begin{split}
    \|\BY-\BW \Ba -\BL \Bb \|^2
=
&\|\BY-\hat \BY\|^2+\|\hat \BY-\BW \Ba -\BL \Bb \|^2
\\
=
&\|\BY-\hat \BY\|^2+
\|\BH_\BW(\hat \BY - \BL \Bb)-\BW \Ba \|^2
+
\|(\BI_n-\BH_\BW) (\hat \BY -\BL \Bb) \|^2
.
    \end{split}
\end{equation*}
We have
\begin{equation*}
    \begin{split}
        &
    \int_{\mathbb R^q}
    \exp\left\{
        -\frac{\tau }{2}
        \left(
\|\BH_\BW(\hat \BY - \BL \Bb)-\BW \Ba \|^2
+\Ba^\top \BV_a^{-1} \Ba
\right)
\right\}
    d\Ba
    \\
        =&
    \int_{\mathbb R^q}
    \exp\Big\{
        -\frac{\tau }{2}
        \Big(
            \left\|(\BW^\top \BW +\BV_a^{-1})^{1/2}
\left[\Ba-(\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top (\BW^\top \BW +\BV_a^{-1})\right]\right\|^2
\\
&-(\hat \BY -\BL \Bb)^\top \BW (\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top(\hat \BY -\BL \Bb)
+\| \BH_\BW (\hat{\BY}-\BL \Bb)\|^2
\Big)
\Big\}
    d\Ba
    \\
    =
&
(2\pi)^{q/2} \tau^{-q/2} |\BW\BW^\top+\BV_a^{-1}|^{-1/2}
\\
&\exp\left\{
    -\frac{\tau}{2}\left(
-(\hat \BY -\BL \Bb)^\top \BW (\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top(\hat \BY -\BL \Bb)
+\| \BH_\BW (\hat{\BY}-\BL \Bb)\|^2
\right)
\right\}
.
    \end{split}
\end{equation*}
Thus,
\begin{equation*}
    \begin{split}
    &
    \int_{\mathbb R^q}f(\BY|\Ba,\Bb, \tau)
    \pi(\Ba|\tau)
    \pi(\Bb|\tau)
    \pi(\tau)
    d\Ba
    \\
    =&
    \frac{(\kappa_2/2)^{\kappa_1/2}\tau^{(n+p+\kappa_1)/2-1}}
    {
        (2\pi)^{(n+p)/2} |\BV_a|^{1/2} |\BV_b|^{1/2} \Gamma(\kappa_1/2)
|\BW\BW^\top+\BV_a^{-1}|^{1/2}
    }
    \\
    &
    \exp\Big\{
        -\frac{\tau}{2}
        \Big( 
\|\BY-\hat \BY\|^2
-(\hat \BY -\BL \Bb)^\top \BW (\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top(\hat \BY -\BL \Bb)
+\| \hat{\BY}-\BL \Bb\|^2
\\
&
        + \Bb^\top \BV_b^{-1} \Bb +\kappa_2\Big)
    \Big\}
    .
    \end{split}
\end{equation*}
Note that
\begin{equation*}
    \begin{split}
    &
    \int_{\mathbb R^p}\exp\left\{
        -\frac{\tau}{2}
        \left( 
-(\hat \BY -\BL \Bb)^\top \BW (\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top(\hat \BY -\BL \Bb)
+\| \hat{\BY}-\BL \Bb\|^2
        + \Bb^\top \BV_b^{-1} \Bb \right)
    \right\}
    d\Bb
    \\
    &=
    (2\pi)^{p/2} \tau^{-p/2} |\BL^\top \BC \BL +\BV_b^{-1}|^{-1/2}
    \exp\left\{
        -\frac \tau 2
        \hat \BY^\top 
        \left(
            \BC- \BC \BL (\BL^\top \BC \BL +\BV_b^{-1})^{-1} \BL^\top \BC
        \right)
        \hat \BY
    \right\}
    ,
    \end{split}
\end{equation*}
where $\BC=\BI_n-\BW (\BW^\top \BW +\BV_a^{-1})^{-1} \BW^\top$.
Thus,
\begin{equation*}
    \begin{split}
    &
    \int_{\mathbb R^p }\int_{\mathbb R^q}f(\BY|\Ba,\Bb, \tau)
    \pi(\Ba|\tau)
    \pi(\Bb|\tau)
    \pi(\tau)
    d\Ba
    d\Bb
    \\
    =&
    \frac{(\kappa_2/2)^{\kappa_1/2}\tau^{(n+\kappa_1)/2-1}}
    {
        (2\pi)^{n/2} |\BV_a|^{1/2} |\BV_b|^{1/2} \Gamma(\kappa_1/2)
|\BW\BW^\top+\BV_a^{-1}|^{1/2}
|\BL^\top \BC \BL +\BV_b^{-1}|^{1/2}
    }
    \\
    &
    \exp\Big\{
        -\frac{\tau}{2}
        \Big( 
\|\BY-\hat \BY\|^2
        +\hat \BY^\top 
        \left(
            \BC- \BC \BL (\BL^\top \BC \BL +\BV_b^{-1})^{-1} \BL^\top \BC
        \right)
        \hat \BY
 +\kappa_2
 \Big)
    \Big\}
    .
    \end{split}
\end{equation*}
Thus,
\begin{equation*}
    \begin{split}
    &
    \int_{0}^\infty \int_{\mathbb R^p }\int_{\mathbb R^q}f(\BY|\Ba,\Bb, \tau)
    \pi(\Ba|\tau)
    \pi(\Bb|\tau)
    \pi(\tau)
    d\Ba
    d\Bb
    d\tau
    \\
    =&
    \frac{(\kappa_2/2)^{\kappa_1/2}\Gamma((n+\kappa_1)/2)}
    {
        (2\pi)^{n/2} |\BV_a|^{1/2} |\BV_b|^{1/2} \Gamma(\kappa_1/2)
|\BW\BW^\top+\BV_a^{-1}|^{1/2}
|\BL^\top \BC \BL +\BV_b^{-1}|^{1/2}
    }
    \\
    &
    \left(\frac{
\|\BY-\hat \BY\|^2
        +\hat \BY^\top 
        \left(
            \BC- \BC \BL (\BL^\top \BC \BL +\BV_b^{-1})^{-1} \BL^\top \BC
        \right)
        \hat \BY
 +\kappa_2
    }{2}\right)^{-(n+\kappa_1)/2}
    .
    \end{split}
\end{equation*}
Under $H_0$, that is $\BV_b\to 0$, we have
\begin{equation*}
    \begin{split}
    &
    \int_{0}^\infty \int_{\mathbb R^q}f(\BY|\Ba,0, \tau)
    \pi(\Ba|\tau)
    \pi(\tau)
    d\Ba
    d\tau
    \\
    =&
    \frac{(\kappa_2/2)^{\kappa_1/2}\Gamma((n+\kappa_1)/2)}
    {
        (2\pi)^{n/2} |\BV_a|^{1/2} \Gamma(\kappa_1/2)
|\BW\BW^\top+\BV_a^{-1}|^{1/2}
    }
    \\
    &
    \left(\frac{
\|\BY-\hat \BY_0\|^2
        +\hat \BY_0^\top 
            \BC
        \hat \BY_0
 +\kappa_2
    }{2}\right)^{-(n+\kappa_1)/2}
    .
    \end{split}
\end{equation*}
Thus,
\begin{equation*}
    \text{BF}=
    \frac{1}
    {
         |\BV_b|^{1/2} 
|\BL^\top \BC \BL +\BV_b^{-1}|^{1/2}
    }
    \left(\frac{
\|\BY-\hat \BY\|^2
        +\hat \BY^\top 
        \left(
            \BC- \BC \BL (\BL^\top \BC \BL +\BV_b^{-1})^{-1} \BL^\top \BC
        \right)
        \hat \BY
 +\kappa_2
    }{
\|\BY-\hat \BY_0\|^2
        +\hat \BY_0^\top 
            \BC
        \hat \BY_0
 +\kappa_2
}\right)^{-(n+\kappa_1)/2}
\end{equation*}


















%\begin{appendices}
    %\section{haha1}
    %\section{haha2}
%\end{appendices}
%\section*{Acknowledgements}
%This work was supported by the National Natural Science Foundation of China under Grant Nos.\ xxxxx, xxxx.



\bibliographystyle{apalike}
\bibliography{mybibfile}

\end{document}
